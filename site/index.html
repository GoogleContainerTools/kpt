<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="robots" content="noindex" />
    <title>kpt - Home</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/asciinema-player@2.6.1/resources/public/css/asciinema-player.css"
    />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <div id="app"></div>
    <script>
      window.$docsify = {
        name: "kpt",
        nameLink: window.location.origin,
        search: {
          maxAge: 43200000,
          placeholder: "Search",
          paths: "auto",
        },
        loadSidebar: "sidebar.md",
        alias: {
          "/*.*/sidebar.md": "/sidebar.md",
        },
        coverpage: "coverpage.md",
        auto2top: true,
        repo: "true",
        pagination: {
          crossChapter: true,
        },
        corner: {
          url: "https://github.com/GoogleContainerTools/kpt",
          icon: "github",
        },
        routerMode: "history",
        markdown: {
          renderer: {
            image: function (href, title) {
              return `<img src="${href}" data-origin="${href}" alt="${title}">`;
            },
          },
        },
        plugins: [
          function (hook, vm) {
            // Process Markdown directives appropriately.
            hook.beforeEach(function (content) {
              content = processAsciinemaTags(content);

              // Until all source markdown files stop using Hugo directives,
              // convert here for compatibility.
              content = convertFromHugo(content);
              return content;
            });

            // Add title to book Markdown pages based on directory structure.
            hook.beforeEach(processBookPageTitle);

            // Show navigation footer for book pages.
            hook.doneEach(showBookPageFooters);

            // Process elements in the navigation sidebar.
            hook.doneEach(function () {
              const sidebar = document
                .getElementsByClassName("sidebar-nav")
                .item(0);

              // Only show child pages for currently active page to avoid sidebar cluttering.
              addSidebarCollapsibility(sidebar);
            });
          },
        ],
      };

      function convertFromHugo(content) {
        const hugoHideDirectives = /{{% hide %}}.+?{{% \/hide %}}/gms;
        const hugoDirectiveTags = /{{.*}}/g;

        content = processHugoTitleHeading(content);
        return content
          .replace(hugoHideDirectives, "")
          .replace(hugoDirectiveTags, "");
      }

      function showBookPageFooters() {
        const paginationFooters = Array.from(
          document.getElementsByClassName("docsify-pagination-container")
        );
        const isBookPage = document.location.pathname
          .toLowerCase()
          .startsWith("/book");
        paginationFooters.forEach(
          (el) => (el.style.display = isBookPage ? "flex" : "none")
        );

        const previousPaginationButtons = Array.from(
          document.getElementsByClassName("pagination-item--previous")
        );
        const isBookCover =
          isBookPage && document.location.pathname.toLowerCase().length < 7;
        previousPaginationButtons.forEach(
          (el) => (el.style.display = isBookCover ? "none" : "flex")
        );
      }

      function processBookPageTitle(content) {
        const pathname = window.location.pathname.toLowerCase();

        // Matches a path like /book/02-concepts/01-packages
        const bookPath = /^\/book\/(\d+)-(.+)\/(\d+)?-?(.+)?/;
        const bookPathMatch = pathname.match(bookPath);

        if (bookPathMatch) {
          const pageNumber = parseInt(bookPathMatch[3]);

          // Use chapter name if on intro page and page name otherwise.
          const chapterNum = `# ${parseInt(bookPathMatch[1])}${
            pageNumber > 0 ? `.${pageNumber}` : ""
          }`;
          const pageTitle =
            pageNumber > 0 ? bookPathMatch[4] : bookPathMatch[2];

          content =
            `${chapterNum} ${pageTitle.replaceAll("-", " ").toTitleCase()}\n` +
            content;
        }

        return content;
      }

      function addSidebarCollapsibility(sidebar) {
        const tocLists = Array.from(sidebar?.getElementsByTagName("ul"));

        // Hide a child list if neither its parent nor any of its descendants are active.
        tocLists.forEach((ul) =>
          ul.parentElement.classList.contains("active") ||
          ul.getElementsByClassName("active").length
            ? ul.classList.remove("inactive")
            : ul.classList.add("inactive")
        );
      }

      // Make Markdown standard titles (# Title) out of the following:
      // +++
      // title: Page Title
      // +++
      function processHugoTitleHeading(content) {
        const titleBlock = /^[\+\-]{3}[\s\S]*?^[\+\-]{3}$/m;
        const titleMatch = content.match(/title:\s*["'](.*)["']/);

        const titleHeading = titleMatch ? `# ${titleMatch[1]}` : "";

        return content.replace(titleBlock, titleHeading);
      }

      // Convert Hugo Asciinema directives to HTML.
      function processAsciinemaTags(content) {
        const asciinemaDirective = /{{<\s*asciinema.+key="(.+?)".+}}/g;

        return content.replace(
          asciinemaDirective,
          (_, fileName) =>
            `<asciinema-player src="${window.location.origin}/static/casts/${fileName}.cast" cols="160"></asciinema-player>`
        );
      }
    </script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/js/docsify-themeable.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify-corner/dist/docsify-corner.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/asciinema-player@2.6.1/resources/public/js/asciinema-player.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1.22/components/prism-bash.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1.22/components/prism-yaml.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1.22/components/prism-go.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs@1.22/components/prism-typescript.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/@gouch/to-title-case@2.2.1/to-title-case.min.js"></script>
    <!--Fallback content on 404s can go here.-->
  </body>
  <style>
    :root {
      --content-max-width: 60em;
      --search-input-color: black;
      --search-result-heading-color: white;
      --search-result-keyword-background: unset;
      --search-result-keyword-margin: unset;
      --search-result-keyword-font-weight: 800;
      --sidebar-background: #30638e;
      --sidebar-nav-link-color: rgba(255, 255, 255, 0.75);
      --sidebar-nav-link-color--active: white;
      --sidebar-nav-link-font-weight--active: 600;
      --sidebar-nav-link-text-decoration--active: underline;
      --sidebar-nav-link-before-content-l3: none;
      --sidebar-name-color: white;
      --sidebar-toggle-offset-top: unset;
      --sidebar-width: 20rem;
      --pagination-label-font-size: var(--font-size-l);
      --pagination-title-font-size: 0px;
    }
    .sidebar {
      color: rgba(255, 255, 255, 0.75);
    }
    .sidebar-toggle {
      bottom: 0;
    }

    /* Hide inactive lists whose titles aren't links. */
    .sidebar-nav ul a + ul.inactive {
      display: none;
    }

    .sidebar-nav ul a {
      white-space: unset;
    }

    .sidebar-nav .book-outline ul {
      margin-left: var(--sidebar-nav-indent);
    }

    .pagination-item-label {
      z-index: -1;
      position: relative;
    }
  </style>
</html>
